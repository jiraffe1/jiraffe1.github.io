var spline,stepSlider,maxVelSlider,tolSlider;function setup(){createCanvas(800,600),spline=new Spline,createP("Generation settings [Broken] Click to add nodes"),createP("StepSize"),stepSlider=createSlider(.1,2,.5,.05),createP("MaxVel"),maxVelSlider=createSlider(1,10,4,.05),createP("CurveTolerance"),tolSlider=createSlider(10,50,20,.05),createA("https://jiraffe1.github.io/web/game.html", "back"),stepSlider.mousePressed(recalculatePoints),tolSlider.mousePressed(recalculatePoints),maxVelSlider.mousePressed(recalculatePoints)}function draw(){background(255),spline.update(),updateSliders()}function updateSliders(){spline.step=stepSlider.value(),spline.tol=tolSlider.value(),spline.maxSpd=maxVelSlider.value()}function recalculatePoints(){background(255),spline.recalculatePoints(),spline.update()}var Spline=function(){this.ctrlpoints=new Array,this.track=new Array,this.step=.5,this.tol=20,this.debug=!0,this.maxSpd=4};function mouseClicked(){mouseX>0&&mouseX<width&&mouseY>0&&mouseY<height&&(spline.ctrlpoints.push(new Node(mouseX,mouseY)),1!==spline.ctrlpoints.length&&spline.recalculatePoints())}Spline.prototype.recalculatePoints=function(){for(var e=0,t=this.ctrlpoints,i=createVector(t[0].x,t[0].y),s=createVector(t[0].x,t[0].y),r=createVector(0,0),l=createVector(t[t.length-1].x,t[t.length-1].y),n=0;n<800*t.length;n++){var o=createVector(i.x,i.y);o.sub(s);if(o.normalize(),o.mult(this.step),r.add(o),r.setMag(min(r.mag(),this.maxSpd)),s.add(r),dist(s.x,s.y,i.x,i.y)<this.tol&&(e++,i=createVector(this.ctrlpoints[e].x,this.ctrlpoints[e].y)),dist(s.x,s.y,l.x,l.y)<this.tol)break;this.track.push(new LineN(s.x,s.y))}},Spline.prototype.display=function(){strokeWeight(15);for(var e=1;e<this.track.length;e++)stroke(0,0,0),point(this.track[e].x,this.track[e].y);for(var t=0;t<this.ctrlpoints.length;t++)this.debug&&(stroke(100,100,100,100),strokeWeight(this.tol),point(this.ctrlpoints[t].x,this.ctrlpoints[t].y)),stroke(0,0,0),strokeWeight(3),0===e&&stroke(255,0,0),point(this.ctrlpoints[t].x,this.ctrlpoints[t].y)},Spline.prototype.update=function(){this.display()};var Node=function(e,t){this.x=e,this.y=t},LineN=function(e,t){this.x=e,this.y=t};