var world,drag,settings;function setup(){drag=null,settings=new set,world=new Array,createCanvas(800,600),addEdges(),createP("Q - Create ball"),createP("W - Create static ball"),createP("O - Create creature"),createP("P - Create static square"),createP("Left Mouse - Drag nodes"),createP("R - Reset")}function draw(){background(255);for(var e=world.length-1;e>=0;e--){world[e].display()}stroke(0),fill(0),push(),strokeWeight(.5),textSize(16),text(floor(frameRate()),30,30),pop()}function keyPressed(){switch(key){case"q":var e=mouseX,s=mouseY,t=new node(new p5.Vector(e,s),!1);world.push(t);break;case"w":var i=mouseX,r=mouseY,a=new node(new p5.Vector(i,r),!0);world.push(a);break;case"o":newAddSquare(mouseX,mouseY,!1,max(settings.creatureSize+int(random(-settings.creatureMutability,settings.creatureMutability)),1),max(settings.creatureSize+int(random(-settings.creatureMutability,settings.creatureMutability)),1),30);break;case"p":addSquare(mouseX,mouseY,!0);break;case"r":setup()}}function addEdges(){for(var e=0;e<width/12;e++){var s=14*e,t=height,i=new node(new p5.Vector(s,t),!0);world.push(i)}}function addSquare(e,s,t){var i=new node(new p5.Vector(e+50,s),t),r=new node(new p5.Vector(e,s),t),a=new node(new p5.Vector(e+50,s+50),t),n=new node(new p5.Vector(e,s+50),t);i.addLink(r),i.addLink(n),i.addLink(a),r.addLink(i),r.addLink(n),r.addLink(a),a.addLink(i),a.addLink(r),a.addLink(n),n.addLink(a),n.addLink(i),n.addLink(r),world.push(i),world.push(r),world.push(a),world.push(n)}function newAddSquare(e,s,t,i,r,a){for(var n=processing2jsNewNDimArray([i,r]),o=0;o<i;o++)for(var d=0;d<r;d++){var h=e+o*a,l=s+d*a;if(0==o||o==i-1||0==d||d==r-1){var u=new node(new p5.Vector(h,l),t);n[o][d]=u,world.push(u)}}for(var c=0;c<i;c++)for(var p=0;p<r;p++){u=n[c][p];for(var w=0;w<i;w++)for(var g=0;g<r;g++)null!=n[w][g]&&null!=u&&u.addLink(n[w][g])}}class node{constructor(e,s){this.size=0,this.bounciness=0,this.linkDists=new Array,this.pos=e,this.vel=new p5.Vector(0,0),this.links=new Array,this.isKinematic=s,this.size=settings.defaultSize+random(-5,5),this.bounciness=settings.defaultBounciness}display(){this.isKinematic?stroke(100,100,100):stroke(255,0,0),fill(255,0,0),strokeWeight(this.size),point(this.pos.x,this.pos.y),stroke(0),strokeWeight(3),mouseIsPressed&&dist(mouseX,mouseY,this.pos.x,this.pos.y)<9&&0==this.isKinematic&&null==drag?drag=this:mouseIsPressed||(drag=null),drag==this&&(this.pos.set(mouseX,mouseY),this.vel.set(0,0)),this.physics()}physics(){if(this.vel.limit(settings.defaultMaxVel),!this.isKinematic){for(var e=world.length-1;e>=0;e--){(s=world[e])!=this&&p5.Vector.dist(this.pos,s.pos)<this.size/2+s.size/2&&this.repelNode(s)}this.vel.y+=settings.gravity,this.pos.add(this.vel);for(e=this.links.length-1;e>=0;e--){var s,t=(s=this.links[e]).pos;this.isKinematic||this.effectLink(s),line(this.pos.x,this.pos.y,t.x,t.y)}}}repelNode(e){var s=new p5.Vector(this.pos.x,this.pos.y),t=new p5.Vector(e.pos.x,e.pos.y),i=s.sub(t);i.setMag(3*this.bounciness),i.mult(-1),this.vel.sub(i),this.vel.mult(this.bounciness)}addLink(e){this.links.push(e),this.linkDists.push(p5.Vector.dist(this.pos,e.pos))}effectLink(e){for(var s=0,t=this.links.length-1;t>=0;t--)if(this.links[t]==e){s=this.linkDists[t];break}var i=p5.Vector.dist(this.pos,e.pos),r=new p5.Vector(this.pos.x,this.pos.y),a=new p5.Vector(e.pos.x,e.pos.y).sub(r);i>s?(a.setMag(settings.defaultSpringiness),this.vel.add(a)):(a.setMag(-settings.defaultSpringiness),this.vel.add(a))}}class set{constructor(){this.gravity=.2,this.defaultSize=15,this.defaultMaxVel=10,this.defaultSpringiness=.4,this.defaultBounciness=.4,this.creatureMutability=2,this.creatureSize=3}}function processing2jsNewNDimArray(e){if(e.length>0){for(var s=e[0],t=e.slice(1),i=new Array,r=0;r<s;r++)i[r]=processing2jsNewNDimArray(t);return i}}