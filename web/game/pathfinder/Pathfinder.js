var Settings={NavRefresh:3,MaxParticles:10,showDebug:!1,autoAllocateTarget:!1},Pset={Speed:.2,MaxVelocity:4,ReturnVelocity:.2,LoseVelocity:1.035},walkers=[],Movestor=[],grid=["xxxxxxxxxxxxxxxxxxxx","x_x________________x","x_x_______xxxxxxx__x","x_x_xxxxxxx______x_x","x_x_x_____x__xx__x_x","x_x_x_____x___xx___x","x___x_xxx__x__xx___x","xxxx__xxxx____xxxxxx","x_____xxxxxxxx_____x","x__xxxxx___________x","x___________xxxxxx_x","xxxxxxxxxxxx_______x","x________xxx__xxxxxx","x_________xx_______x","xxxxxxxx____xxxxx__x","xxxx___xx___xx_____x","x___________xx__xxxx","x__xxxxxxxxxx______x","x__________________x","xxxxxxxxxxxxxxxxxxxx"],navGrid=["____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________"];String.prototype.replaceAt=function(_,t){return this.substr(0,_)+t+this.substr(_+t.length)};var mover=function(_){this.pos=_,this.XV=0,this.YV=0,this.AX=0,this.AY=0,this.r=random(255),this.g=random(255),this.b=random(255)};mover.prototype.show=function(){fill(this.r,this.g,this.b,250);let _=createVector(this.XV,this.YV).heading();push(),translate(this.pos.x,this.pos.y),rotate(_),rect(0,0,15,7),fill(this.r,this.g,this.b,250/(abs(this.XV)+abs(this.YV))),ellipse(0,0,7,7),pop()},mover.prototype.run=function(){fill(0,9,255,250),this.stunned--,this.stunned=max(this.stunned,0),0===walkers.length&&("d"===navGrid[this.AY][this.AX]?this.YV+=Pset.Speed:"u"===navGrid[this.AY][this.AX]?this.YV-=Pset.Speed:"r"===navGrid[this.AY][this.AX]?this.XV+=Pset.Speed:"l"===navGrid[this.AY][this.AX]&&(this.XV-=Pset.Speed),this.pos.x+=this.XV,this.AX=floor(this.pos.x/20),this.AY=floor(this.pos.y/20),"_"===navGrid[this.AY][this.AX]&&(this.XV>0?(this.XV*=-(Pset.ReturnVelocity+random(.1,.3)),this.pos.x=20*this.AX-1):this.XV<0&&(this.XV*=-(Pset.ReturnVelocity+random(.1,.3)),this.pos.x=20*this.AX+21)),this.pos.y+=this.YV,this.AX=floor(this.pos.x/20),this.AY=floor(this.pos.y/20),"_"===navGrid[this.AY][this.AX]&&(this.YV>0?(this.YV*=-(Pset.ReturnVelocity+random(.1,.3)),this.pos.y=20*this.AY-1):this.YV<0&&(this.YV*=-(Pset.ReturnVelocity+random(.1,.3)),this.pos.y=20*this.AY+21)),this.XV/=Pset.LoseVelocity,this.YV/=Pset.LoseVelocity,this.XV=constrain(this.XV,-Pset.MaxVelocity,Pset.MaxVelocity),this.YV=constrain(this.YV,-Pset.MaxVelocity,Pset.MaxVelocity))};var checkGrid=function(_,t){return"x"!==grid[t][_]&&"_"===navGrid[t][_]},walker=function(_,t,x,s,e){this.x=_,this.y=t,this.done=!1};function keyPressed(){for(var _=0;_<20;_++)for(var t=0;t<20;t++)"_"===grid[_][t]&&"_"!==navGrid[_][t]&&Movestor.unshift(new mover(createVector(random(20*t,20*t+20),random(20*_,20*_+20))))}function mouseMoved(){mouseX>20&&mouseX<379&&mouseY>20&&mouseY<379&&frameCount%Settings.NavRefresh==1&&"_"===grid[floor(mouseY/20)][floor(mouseX/20)]&&(frameRate(max),walkers=[],(navGrid=["____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________","____________________"])[floor(mouseY/20)]=navGrid[floor(mouseY/20)].replaceAt(floor(mouseX/20),"X"),walkers.push(new walker(floor(mouseX/20),floor(mouseY/20),0)))}function mouseClicked(){mouseX>20&&mouseX<379&&mouseY>20&&mouseY<379&&("x"===grid[floor(mouseY/20)][floor(mouseX/20)]?grid[floor(mouseY/20)]=grid[floor(mouseY/20)].replaceAt(floor(mouseX/20),"_"):"_"===grid[floor(mouseY/20)][floor(mouseX/20)]&&(grid[floor(mouseY/20)]=grid[floor(mouseY/20)].replaceAt(floor(mouseX/20),"x")))}function setup(){createCanvas(400,400),createP("click to place and remove blocks"),createP("press any key to mak more cars"),createP("they follow your mouse"),noStroke(),rectMode(CENTER),textAlign(CENTER,CENTER),textSize(20)}walker.prototype.run=function(){this.done=!0,checkGrid(this.x+1,this.y)&&(navGrid[this.y]=navGrid[this.y].replaceAt(this.x+1,"l"),walkers.push(new walker(this.x+1,this.y))),checkGrid(this.x-1,this.y)&&(navGrid[this.y]=navGrid[this.y].replaceAt(this.x-1,"r"),walkers.push(new walker(this.x-1,this.y))),checkGrid(this.x,this.y+1)&&(navGrid[this.y+1]=navGrid[this.y+1].replaceAt(this.x,"u"),walkers.push(new walker(this.x,this.y+1))),checkGrid(this.x,this.y-1)&&(navGrid[this.y-1]=navGrid[this.y-1].replaceAt(this.x,"d"),walkers.push(new walker(this.x,this.y-1)))},draw=function(){if(background(255,100),0!==walkers.length)for(var _=0;_<100;_++)for(var t=walkers.length-1;t>=0;t--){var x=walkers[t];x.done?(walkers.splice(t,1),0===walkers.length&&frameRate(60)):x.run()}fill(20),Movestor.length=constrain(Movestor.length,0,Settings.MaxParticles);for(var s=0;s<20;s++)for(var e=0;e<20;e++)"x"===grid[s][e]&&rect(10+20*e,10+20*s,20,20),Settings.showDebug&&("u"===navGrid[s][e]&&text("↑",10+20*e,10+20*s),"d"===navGrid[s][e]&&text("↓",10+20*e,10+20*s),"l"===navGrid[s][e]&&text("←",10+20*e,10+20*s),"r"===navGrid[s][e]&&text("→",10+20*e,10+20*s),"X"===navGrid[s][e]&&text("X",10+20*e,10+20*s));for(t=Movestor.length-1;t>=0;t-=1){Movestor[t].run()}for(t=Movestor.length-1;t>=0;t--){Movestor[t].show()}Settings.autoAllocateTarget};