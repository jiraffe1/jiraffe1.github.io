const worldMap=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2,2,0,2,2,0,0,0,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,1,0,0,1,1,1,1,1,0,0,1],[1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0,0,0,2,0,0,0,0,0,2,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,0,0,1,0,0,0,2,0,0,0,0,0,2,0,0,0,0,1,0,0,1,0,0,1,1,1,0,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2,2,0,2,2,0,0,0,0,0,1,0,1,1,0,0,1,1,1,0,1,0,0,1],[1,2,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,1,1,0,0,1],[1,0,0,1,1,3,3,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,3,0,1,0,0,0,0,0,1,0,0,0,0,1],[1,0,1,3,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,1,1,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,3,0,1,0,0,0,1,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,0,1,3,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,2,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,1,1,1,1,1,1,1,0,1],[1,0,0,1,0,1,0,0,1,0,0,1,1,0,0,1,1,3,0,0,1,1,1,0,0,1,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,2,0,0,1,0,0,1,0,0,0,1,0,0,0,1,1,1,0,1,1,1,1,0,0,1,0,1,1,1,1,1,1,0,1,1,1,0,1],[1,0,0,0,0,1,0,0,1,0,0,1,2,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,1],[1,0,0,1,1,1,0,0,0,0,1,1,0,0,2,0,0,0,0,3,0,0,1,1,1,1,1,1,3,3,1,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,1,1,0,1],[1,0,0,0,0,1,1,0,0,0,0,0,0,0,2,1,0,0,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,0,1],[1,1,1,0,0,1,0,1,1,1,1,1,1,0,0,1,1,3,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,1,0,1,1,1,1,1,0,1,0,0,0,0,0,1,1,1,1,0,1],[1,0,0,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1,1,1,1,0,1],[1,0,0,0,0,1,0,0,1,1,1,0,0,1,1,0,1,3,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,1,1,1,1,0,1],[1,1,1,0,0,1,0,0,1,0,1,0,0,1,0,0,0,3,0,0,1,1,0,0,0,0,0,1,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,1,1,1,0,0,1],[1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,3,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,1,1,0,0,1],[1,0,0,2,1,1,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,3,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,1,0,0,1],[1,1,1,2,1,1,1,1,0,0,1,1,1,1,0,0,0,1,1,0,0,0,3,3,3,3,0,0,1,0,1,1,0,1,0,3,1,0,0,1,0,0,0,0,0,0,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,0,3,1,1,0,0,0,0,0,0,0,0,1,1,0,1],[1,0,1,0,1,0,1,1,1,1,0,0,0,0,0,0,1,3,0,1,0,1,0,1,0,2,1,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,1,0,0,0,1,0,0,1],[1,0,1,1,0,0,0,0,0,0,0,1,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,2,0,0,1,0,1,1,1,0,0,1,0,0,1],[1,0,1,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,1,0,1,0,0,1,1,0,1,1,1,0,1,0,0,0,0,0,0,1,0,0,0,1,1,0,1],[1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,1,0,1,0,2,0,0,0,1,0,0,0,0,0,1,2,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,2,2,2,1,1,1,1,1,1,1,0,1,0,1,1],[1,0,1,1,0,0,1,0,0,0,1,1,1,1,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1],[1,0,1,0,1,0,1,2,0,2,0,0,0,0,0,0,0,2,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,0,1,0,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,1],[1,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,0,3,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,1,0,0,1,0,0,0,0,0,1,1],[1,0,1,1,0,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,1,0,0,0,0,0,1,1],[1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],screenModes=["screen","minimap"],floorColor=130,ceilingColor=65,stripWidth=1;var screenMode=screenModes[0],screenLines=[],wallImages=[],player={x:16,y:10,dir:0,rot:0,speed:0,moveSpeed:.1,rotSpeed:3*Math.PI/180},mapWidth=worldMap[0].length,mapHeight=worldMap.length,miniMapScale=8,screenWidth=800,screenHeight=600,fov=60*Math.PI/180,numRays=Math.ceil(screenWidth/stripWidth),fovHalf=fov/2,viewDist=screenWidth/2/Math.tan(fov/2),twoPI=2*Math.PI;function preload(){}function setup(){createP("Arrow keys to move"),createP("Hold TAB for minmap"),createCanvas(screenWidth,screenHeight).class("gameCanvas");window.devicePixelRatio;var e=document.getElementById("defaultCanvas0"),a=e.getContext("2d");a.webkitImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.imageSmoothingEnabled=!1,e.style.width=windowWidth,e.style.height=2*windowHeight,fill(255)}function draw(){clear(),(screenMode=keyIsDown(TAB)?screenModes[1]:screenModes[0])==screenModes[0]?(resetScreenDefaults(),drawScreen()):screenMode==screenModes[1]&&(resetScreenDefaults(),drawMinimap()),move()}function drawScreen(){noStroke(),fill(20,100,20),rect(0,screenHeight/2,screenWidth,screenHeight/2),fill(50,150,255),rect(0,0,screenWidth,screenHeight/2),screenLines=[];for(var e=0;e<numRays;e++){var a=(-numRays/2+e)*stripWidth,r=Math.sqrt(a*a+viewDist*viewDist),t=Math.asin(a/r);castRay(player.rot+t)}for(e=0;e<screenWidth;e+=stripWidth)if(null!=screenLines[e]){screenLines[e][0];var i=screenLines[e][1],o=screenLines[e][2],n=screenLines[e][3];screenLines[e][4];switch(n){case 1:fill(255-(300-i),0,0);break;case 2:fill(0,0,255-(300-i));break;case 3:fill(100-(100-2*i)-50,100-(100-2*i)-50,100-(100-2*i)-50)}noStroke(),rect(e,o,stripWidth,i)}}function castRay(e){(e%=twoPI)<0&&(e+=twoPI);for(var a=e>.75*twoPI||e<.25*twoPI,r=e<0||e>Math.PI,t=0,i=Math.sin(e),o=Math.cos(e),n=0,l=!0,s=a?1:-1,p=s*(M=i/o),c=a?Math.ceil(player.x):Math.floor(player.x),d=player.y+(c-player.x)*M;c>=0&&c<mapWidth&&d>=0&&d<mapHeight;){var y=Math.floor(c+(a?0:-1)),h=Math.floor(d);if(worldMap[h][y]>0){n=(u=c-player.x)*u+(w=d-player.y)*w,t=worldMap[h][y],a||(textureX=1-textureX),c,d,!1;break}c+=s,d+=p}var M,f=r?-1:1,m=f*(M=o/i);for(d=r?Math.floor(player.y):Math.ceil(player.y),c=player.x+(d-player.y)*M;c>=0&&c<mapWidth&&d>=0&&d<mapHeight;){h=Math.floor(d+(r?-1:0)),y=Math.floor(c);if(worldMap[h][y]>0){var u,w;(u=c-player.x)<(w=d-player.y)&&(l=!0);var v=u*u+w*w;(!n||v<n)&&(n=v,c,d,t=worldMap[h][y],textureX=c%1,r&&(textureX=1-textureX));break}c+=m,d+=f}if(n){n=Math.sqrt(n),n*=Math.cos(player.rot-e);var g=Math.round(viewDist/n),W=g*stripWidth,S=Math.round((screenHeight-g)/2);screenLines.push([W,g,S,t,l])}}function resetScreenDefaults(){fill(255),stroke(0),strokeWeight(1)}function drawMinimap(){push(),translate(player.x*miniMapScale*-.5,player.y*miniMapScale*-.5),fill(200),noStroke();for(var e=0;e<mapHeight;e++)for(var a=0;a<mapWidth;a++){worldMap[e][a]>0&&rect(a*miniMapScale,e*miniMapScale,miniMapScale,miniMapScale)}fill(color("red")),rect(player.x*miniMapScale-2,player.y*miniMapScale-2,miniMapScale/2,miniMapScale/2),strokeWeight(2),stroke(color("red")),line(player.x*miniMapScale,player.y*miniMapScale,(player.x+2*Math.cos(player.rot))*miniMapScale,(player.y+2*Math.sin(player.rot))*miniMapScale),pop()}function keyPressed(){return keyCode===LEFT_ARROW?player.dir=-1:keyCode===RIGHT_ARROW&&(player.dir=1),keyCode===UP_ARROW?player.speed=1:keyCode===DOWN_ARROW&&(player.speed=-1),116===keyCode&&location.reload(),!1}function keyReleased(){return keyCode!==LEFT_ARROW&&keyCode!==RIGHT_ARROW||(player.dir=0),keyCode!==UP_ARROW&&keyCode!==DOWN_ARROW||(player.speed=0),!1}function move(){var e=player.speed*player.moveSpeed;player.rot+=player.dir*player.rotSpeed;var a=player.x+Math.cos(player.rot)*e,r=player.y+Math.sin(player.rot)*e;isBlocking(a,r)||(player.x=a,player.y=r)}function isBlocking(e,a){return a<0||a>=mapHeight||e<0||e>=mapWidth||0!=worldMap[Math.floor(a)][Math.floor(e)]}document.addEventListener("keydown",function(e){9==e.keyCode&&e.preventDefault()},!1);